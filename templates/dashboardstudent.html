<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Dashboard student</title>
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  </head>
  <body>

    <header class="main-header">
        <div class="logo">NoteApp</div> <div class="header-actions">
           
        </div>
        <nav class="nav-links">
            <button class="nav-button college-button">
                <a href="{{ url_for('student') }}">College</a>
            </button>
            <button class="nav-button logout-button">
                <a href="{{ url_for('logout') }}">Logout</a>
            </button>
        </nav>
    </header>

    <div class="dashboard-container">
        <div class="dashboard-top-bar">
            <h2>My Notes</h2>
            <div class="action-buttons">
                <a href="{{ url_for('scan_qr') }}">
                    <button class="cta-button scan-qr-button"> Scan QR Code</button>
                </a>
                <a href="{{ url_for('add_note', student_id=student_id) }}">
                    <button class="cta-button add-note-button"> Add Note</button>
                </a>
            </div>
            


        </div>

        <ul class="notes-grid">
            {% for note in notes %}
                <li class="note-card note-color-{{ loop.index % 4 + 1 }}"> 
                    <div class="note-title-area">
                        <strong>{{ note[1] }}</strong>
                    </div>
                    <div class="note-content-preview">
                        {{ note[3] | truncate(100) }} </div>

                    <div class="note-actions">
                        <a href="{{ url_for('view_note', note_id=note[0]) }}"><button class="action-view">View</button></a>
                        <a href="{{ url_for('edit_note', note_id=note[0]) }}"><button class="action-edit">Edit</button></a>
                        <form method="POST" action="{{ url_for('delete_note_student', note_id=note[0],student_id=student_id) }}" class="delete-form">
                            <button type="submit" class="action-delete" onclick="return confirm('Are you sure you want to delete this note?');">Delete</button>
                        </form>
                    </div>
                    {% if note[4] %}
                        <img src="{{ url_for('static', filename=note[4]) }}" class="note-image-preview">
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
        <div class="study-timer">
            <h3>⏳ Study Timer</h3>

            <label for="timeInput">Set Time (minutes):</label>
            <input type="number" id="timeInput" min="1" placeholder="e.g. 25">

            <button id="startTimerBtn">Start</button>
            <button id="stopTimerBtn" disabled>Stop</button>

            <h2 id="countdownDisplay">00:00</h2>
            <audio id="timerSound" src="{{ url_for('static', filename='sounds/alert.mp3') }}"></audio>

        </div>

        <script>
        let timerInterval;
        let remainingSeconds = 0;
        const timerSound = document.getElementById("timerSound");

        // Allow sound to play later by unlocking it when user first interacts
        document.getElementById("startTimerBtn").addEventListener("click", () => {
            const minutes = parseInt(document.getElementById("timeInput").value);
            if (isNaN(minutes) || minutes <= 0) {
                alert("Please enter a valid number of minutes.");
                return;
            }

            // Unlock the sound on user action
            timerSound.play().then(() => {
                timerSound.pause();
                timerSound.currentTime = 0;
            }).catch(err => console.log("Autoplay unlock attempt:", err));

            remainingSeconds = minutes * 60;
            document.getElementById("startTimerBtn").disabled = true;
            document.getElementById("stopTimerBtn").disabled = false;

            updateDisplay();

            timerInterval = setInterval(() => {
                remainingSeconds--;
                updateDisplay();

                if (remainingSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerSound.play(); // Now this will work
                    alert("⏰ Time’s up! Take a short break.");
                    document.getElementById("startTimerBtn").disabled = false;
                    document.getElementById("stopTimerBtn").disabled = true;
                }
            }, 1000);
        });

        function updateDisplay() {
            const minutes = String(Math.floor(remainingSeconds / 60)).padStart(2, '0');
            const seconds = String(remainingSeconds % 60).padStart(2, '0');
            document.getElementById("countdownDisplay").textContent = `${minutes}:${seconds}`;
        }

        document.getElementById("stopTimerBtn").addEventListener("click", () => {
            clearInterval(timerInterval);
            document.getElementById("startTimerBtn").disabled = false;
            document.getElementById("stopTimerBtn").disabled = true;
        });
        </script>
        
    </div>
  </body>
</html>